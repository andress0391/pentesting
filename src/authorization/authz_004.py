

import os
#import mechanize
from fabrica.otg import OTG

__otg__ = "OTG-AUTHZ-004"

#A8

class AUTHZ_004(OTG):

    def __init__(self, url,dependencia=None):
        super().__init__(dependencia, __otg__)
        self.url = url
        self.ruta = os.getcwd() + "/src/input_validation/Input_validation_testing/payloads/"
        self.name = "payload_err.txt"

    def insecure_object(self):
        attackNumber = 1
        for i in range(5):
            res = mechanize.urlopen(self.url+str(i))
            content = res.read()

            
            if content.find() > 0:
                cadena =  "Possible Direct Object Reference"
                self.adicionarResultado(cadena)

            output = open('response/'+str(attackNumber)+'.txt', 'w')
            output.write(content)
            output.close()
            print(attackNumber)
            attackNumber += 1
    

    def main(self):
        print("================ Iniciando pruebas OTG-AUTHZ-004 ==================\n")
        self.insecure_object()
        if self.detalles.resultado != "":
            self.adicionarRecomendaciones("Por favor actualice la versión de las tecnologías desactualizadas a la última versión estable para evitar ataques con vulnerabilidades de seguridad conocidas")
            self.adicionarRiesgo(0)
            self.almacenarBD()
        print("================ Fin pruebas OTG-AUTHZ-004 ==================\n")

    


    

