#!/usr/bin/python3
# -*- encoding: utf-8 -*-

# Python - ClickjackingTester
# Author: Sebastian Neef - Internetwache.org
# Twitter: @internetwache
# Comment: Happy Hacking!

import sys
from urllib.request import urlopen
from fabrica.otg import OTG

__otg__ = "OTG-CLIENT-009"

class Client_009(OTG):
    def __init__(self, url, dependencia=None, riesgoNegocio=0.0):
        super().__init__(dependencia, __otg__, riesgoNegocio)
        self.url = url
        self.html = ""
        self.complejidad = 1

    def create_poc(self):
        html = '''
    <html>
    <body>
        <iframe src="'''+self.url+'''"></iframe>
    </body>
    </html>
        '''
        self.html =  html

    def is_clickjackable(self):
        url = self.url
        try:
            if url[:4] != "http":
                url = "http://" + url
                sys.argv[1] = url

            req = urlopen(url)
            headers = req.info()

            if not "X-Frame-Options" in headers:
                return True
        except:
            pass
        return False

    def test(self):
        if not self.is_clickjackable():
            return False
        
        self.create_poc()
        return True
    
    def main(self):
        print("================ Inicio prueba OTG-CLIENT-009 ==================\n")
        if self.test():
            msj = "Cabecera X-Frame-Options no encontrada\n"
            msj += "Vulnerable a clickjacking\n" + self.html
            print(msj)
            self.adicionarResultado(msj)
            self.adicionarRecomendaciones("Configure su servidor web incluyendo la cabecera X-Frame-Options, para as√≠ indicar al navegador que no cargue paginas desde otros dominios por medio de la etiqueta HTML 'frame'.")
            self.calcularRiesgo(__otg__, self.riesgoNegocio)
            
            self.almacenarBD()
        else:
            print("NO es vulnerable a clickjacking")
        print("================ Fin prueba OTG-CLIENT-009 ==================\n")

#url = "https://simca.unicauca.edu.co/simca/"
#url = "https://github.com"
#a = Client_009(url)
#a.main()
