#!/usr/bin/python3
# -*- encoding: utf-8 -*-

import os
import subprocess
import time
from multiprocessing import Process

#esperar = 0

__titulo__ = "Enumerar interfaces de administrador"
__descripcion__ = "Las interfaces de administrador pueden estar presentes en la aplicación o en el servidor de aplicaciones para permitir que ciertos usuarios realicen actividades privilegiadas en el sitio, sin embargo, dichas interfaces son accesibles por usuarios no autenticados o sin los permisos requeridos."

class Config_005(object):
    def __init__(self, url):
        self.url = url
        self.dirsearch = os.getcwd() + "/terceros/dirsearch/dirsearch.py"
        self.salida = os.getcwd() + "/src/Salida/adminInterfaces.txt"
        self.diccionario = os.getcwd() + "/diccionarios/adminInterfaces/admin.txt"
        self.extensiones = "php,jsp,jsf,xhtml,xml,aspx,asp,erb,rb,sh,txt,bak"
        self.complejidad = 2
    
    def ejecutarDirsearch(self):
        #global esperar
        with open(os.devnull, "w") as f:
            subprocess.call([self.dirsearch +' --plain-text-report='+ self.salida + " -w " + self.diccionario + " -u " + self.url + " -e " + self.extensiones],
                            shell=True,
                            stdout=f,
                            stderr=subprocess.STDOUT)
            #esperar = 1
        f.close()
    
    def main(self):
        print("================ Inicio prueba OTG-CONFIG-005 ==================\n")
        p = Process(target=self.ejecutarDirsearch)
        p.start()

        mensaje = "Ejecutando enumeración de interfaces de administrador"
        print(mensaje)

        p.join()
        print("\n================ Fin prueba OTG-CONFIG-005 ==================\n")


# a = Config_005("https://simca.unicauca.edu.co/simca/")
# a.main()