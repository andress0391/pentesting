#!/usr/bin/python3
# -*- encoding: utf-8 -*-

import os
import subprocess
import time
from multiprocessing import Process
from fabrica.otg import OTG

class Config_005(OTG):
    def __init__(self, url, dependencia=None):
        super().__init__(dependencia)
        self.url = url
        self.dirsearch = os.getcwd() + "/terceros/dirsearch/dirsearch.py"
        self.salida = os.getcwd() + "/src/Salida/adminInterfaces.txt"
        self.diccionario = os.getcwd() + "/diccionarios/adminInterfaces/admin.txt"
        self.extensiones = "php,jsp,jsf,xhtml,xml,aspx,asp,erb,rb,sh,txt,bak"
        self.complejidad = 2
    
    def ejecutarDirsearch(self):
        with open(os.devnull, "w+") as f:
            subprocess.call([self.dirsearch +' --plain-text-report='+ self.salida + " -w " + self.diccionario + " -u " + self.url + " -e " + self.extensiones],
                            shell=True,
                            stdout=f,
                            stderr=subprocess.STDOUT)
        f.close()
    
    def main(self):
        print("================ Inicio prueba OTG-CONFIG-005 ==================\n")
        p = Process(target=self.ejecutarDirsearch)
        p.start()

        mensaje = "Ejecutando enumeraci√≥n de interfaces de administrador"
        print(mensaje)

        p.join()
        print("\n================ Fin prueba OTG-CONFIG-005 ==================\n")


# a = Config_005("https://simca.unicauca.edu.co/simca/")
# a.main()