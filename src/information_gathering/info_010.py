#!/usr/env/ python
# -*- encoding: utf-8 -*-

import os
import multiprocessing
from fabrica.otg import OTG


__otg__ = "OTG-INFO-010"
class Info_010(OTG):
    def __init__(self, url, dependencia=None):
        super().__init__(dependencia, __otg__)
        self.url = url
        self.salida = "/src/Salida/"
        self.complejidad = 1

    def scanner(self, command, nombreSalida):
        os.system("%s %s > %s" % (command, self.url, os.getcwd()+self.salida+nombreSalida))
       
    def main(self):
        print("================ Inicio prueba OTG-INFO-010 ==================\n")
        jobs = []
        tareas = {"nmap -f --mtu 24 ":"info_010_pscan.txt",
                    "nmap -sS -f --mtu 24 -A ":"info_010_infra.txt",
                    "nmap -sS -f -Pn --script discovery ":"info_010_server.txt"}
        tamTareas = len(tareas)
        i = 0
        for i in range(tamTareas):
            p = multiprocessing.Process(target=self.scanner, args=(list(tareas.keys())[i], list(tareas.values())[i],))
            jobs.append(p)
            p.start()
            p.join()
        
        print("================ Fin prueba OTG-INFO-010 ==================\n")

#a = Info_010("10.200.1.16")
#a.main()