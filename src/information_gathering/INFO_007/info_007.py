# usr/bin/env
# -*- coding: utf-8 -*-

import os
from fabrica.otg import OTG




__otg__ = "OTG-INFO-007"

class Info_007(OTG):
    def __init__(self, url, dependencia=None, riesgoNegocio=0.0):
        
        super().__init__(dependencia, __otg__, riesgoNegocio)
        self.ruta = os.getcwd() + "/src/Salida"
        self.command = os.getcwd() + "/src/information_gathering/INFO_007/"
        self.name = "info_007_"+str(self.pentest.id)+".xml"
        self.url = url

    def spidering(self, url):
        # url = input("URL:")
        # print(url)
        #os.chdir("folder_info_007")
        print(url)
        print(self.command)
        os.system("python3 " +self.command + "main.py --domain " + url + " --output "+self.name + " --verbose")
        # os.chdir("..")
    
    def format_file(self):
        crwaler = ""
        with open(self.ruta + "/"+self.name) as file:
            for line in file:
                tam = len(line)
                if tam > 3:
                    crwaler += line
        file.close()

        #print(crwaler)
        print("craw:" + crwaler)
        self.adicionarResultado(crwaler)

    def main(self):
        print("================ Iniciando prueba OTG-INFO-007 ==================\n")
        print("Detectando el mapa de rutas ...\n")
        url =self.url
        self.spidering(url)
        self.format_file()
        if self.detalles.resultado != "":
            self.adicionarRecomendaciones("Evite colocar su sitemap en el archivo robots.txt")
            self.calcularRiesgo(__otg__, riesgoNegocio=self.riesgoNegocio)

            self.almacenarBD()
        print("================ Fin de la  prueba OTG-INFO-007 ==================\n")
        

# obj = Info_007()
# url = "https://blog.lesite.us"
# #url = "http://www.unicauca.edu.co/versionP/"
# obj.spidering(url)
# obj.format_file()
