# usr/bin/env
# -*- coding: utf-8 -*-

import os
from fabrica.otg import OTG


__otg__ = "OTG-INFO-007"

class Info_007(OTG):
    def __init__(self, url, dependencia=None):
        super().__init__(dependencia, __otg__)
        self.ruta = os.getcwd() + "/src/Salida"
        self.command = os.getcwd() + "/src/information_gathering/INFO_007/"
        self.url = url
        
        

    def spidering(self, url):
        # url = input("URL:")
        # print(url)
        #os.chdir("folder_info_007")
        print(url)
        print("en spidering")
        print(self.command)
        os.system("python3 " +self.command + "main.py --domain " + url + " --output info_007.xml --verbose")
        # os.chdir("..")
    
    def format_file(self):
        crwaler = ""
        with open(self.ruta + "/info_007.xml") as file:
            for line in file:
                tam = len(line)
                if tam > 3:
                    crwaler += line

        #print(crwaler)
        self.adicionarResultado(crwaler)

    def main(self):
        print("================ Iniciando prueba OTG-INFO-007 ==================\n")
        url =self.url
        self.spidering(url)
        self.format_file()
        if self.adicionarResultado != "":
            self.adicionarRecomendaciones("Evite colocar su sitemap en el archivo robots.txt")
            self.adicionarRiesgo(0)
            self.almacenarBD()
        print("================ Fin de la  prueba OTG-INFO-007 ==================\n")
        

# obj = Info_007()
# url = "https://blog.lesite.us"
# #url = "http://www.unicauca.edu.co/versionP/"
# obj.spidering(url)
# obj.format_file()