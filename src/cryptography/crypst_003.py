#!/usr/bin/python3
# -*- encoding: utf-8 -*-

from urllib.parse import urlparse
from src.lib.obtenerForms import ObtenerForms
from fabrica.otg import OTG

__otg__ = "OTG-CRYPST-003"

class Crypst_003(OTG):
    def __init__(self, dependencia=None):
        super().__init__(dependencia, __otg__)
        self.urls = list()
    
    def formsConHTTP(self, urls):
        of = ObtenerForms()
        forms = None
        for url in urls:
            forms = of.get_forms(url)
            if not forms:
                continue
            for i in forms:
                self.inspeccionarHTTP(url, i)
    
    def inspeccionarHTTP(self, url, form):
         u = urlparse(form.url)
         if u.scheme != "https":
             msj = "La informaci√≥n enviada por la url: '{}' navega por medio de un canal inseguro (HTTP).".format(url)
             self.adicionarResultado(msj)
             print(msj)
    
    def main(self):
        print("================ Inicio prueba OTG-CRYPST-003 ==================\n")
        self.urls = self.obtenerResultado("OTG-INFO-007", self.pentest.id)[:-2]
        urls = self.urls
        self.formsConHTTP(urls)

        if self.detalles.resultado != "":
            self.adicionarRecomendaciones("")
            self.adicionarRiesgo(0.0)

            self.almacenarBD()

        print("\n================ Fin prueba OTG-CRYPST-003 ==================\n")
