#!/usr/bin/python3
# -*- encoding: utf-8 -*-

import requests
import time
from urllib.parse import urlparse


def verificarHSTS(url):
    print("URL objetivo: " + url)
    r = requests.head(url)
    codigo_respuesta = r.status_code

    print("Código de respuesta: " + str(codigo_respuesta))

    codigos = [200, 301, 403]

    if codigo_respuesta in codigos:
        try:
            cabecera = 'Strict-Transport-Security'
            print("Buscando la cabecera HSTS (Strict-Transport-Security)")
            time.sleep(1)

            sts = r.headers[cabecera]
            print("Cabecera HSTS encontrada!\n'%s' : %s\n" % (cabecera, sts))
        except KeyError as e:
            print("El servidor no tiene configurado el mecanismo de seguridad HSTS.\n")
    else:
            print("Hubo un problema en establecer la comunicación.\nCódigo : %s.\n" % codigo_respuesta)


def main(url):
    print("================ Inicio prueba OTG-CONFIG-007 ==================\n")
    u = urlparse(url)
    url = u.scheme + "://" + u.netloc + u.path
    verificarHSTS(url)
    print("================ Fin prueba OTG-CONFIG-007 ==================\n")


# url = "https://github.com/"
# url = "http://190.5.199.22:8082/RegistroSiag/Account/wfLogin.aspx"
# main(url)
