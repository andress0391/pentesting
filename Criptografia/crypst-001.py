#!/usr/bin/python3
# -*- encoding: utf-8 -*-

import subprocess
import time
import threading
from urllib.parse import urlparse

esperar = 0
archivoResult = "SSL_TLS.txt"


def ejecutarTestSSL(url):
    global esperar, archivoResult
    with open(archivoResult, "w") as f:
        subprocess.call(['./testssl/testssl.sh', url], stdout=f, stderr=subprocess.STDOUT)
        esperar = 1
    f.close()


def main(url):
    global esperar
    print("================ Inicio prueba OTG-CRYPST-001 ==================\n")
    url = "https://www.owasp.org"
    u = urlparse(url)
    url = u.netloc

    # Ejecutar el subproceso
    hilo = threading.Thread(target=ejecutarTestSSL, args=(url,))
    hilo.start()

    # Mostrar mensaje de espera
    mensaje = "Ejecutando el análisis"
    suspension = "."
    print(mensaje, end="", flush=True)
    while esperar == 0:
        time.sleep(1)
        print(suspension, end="", flush=True)
    print("\nAnálisis finalizado!")
    print("================ Fin prueba OTG-CRYPST-001 ==================\n")


# Si no tiene disponible el puerto 443 para qué probar
# main("https://owasp.org")
