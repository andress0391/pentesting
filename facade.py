# usr/bin/env
# -*- coding: utf-8 -*-


import os
from config_006 import main as mc6
from config_007 import main as mc7
from info_010 import Info
from domine import Dominio

from folder_info_007.info_007 import Info_007
from SQL_XSS.sql import Invpal_005
from SQL_XSS.xss import Invpal_001
from FuerzaBruta_Directorio.authz_002 import main as maz2
from FuerzaBruta_LogIn.authn_003 import main as man3
from Criptografia.crypst_001 import main as mct1

dir_ip = ""


class Facade:
    """
    Controlador de PoC
    """

    def __init__(self, args):
        self.args = args
        self.url = self.args.domain
        self.obj_domine = Dominio(self.url)
        self.obj_nmap = Info()
        self.obj_info_007 = Info_007()
        self.obj_invpal_005 = Invpal_005()
        self.obj_invpal_001 = Invpal_001()
        if os.path.exists("Salida") is False:
            os.makedirs("Salida")

    def get_ip(self):
        """
        Obtener la direccion IP de la URL o dominio
        """
        global dir_ip
        dir_ip = self.obj_domine.obtener_dir_ip()
        print("La dirección IP es : " + dir_ip)

    def port_scan(self):
        "Escanear  puertos del target para OTG-INFO-010"
        # print("-----PORT SCANING-----")
        self.obj_nmap.scanner(dir_ip)

    def crawling(self):
        """
        Spidering del sitio web para OTG-INFO-007
        """
        print("-----SPIDERING------")
        self.obj_info_007.spidering(self.url)

    def sql(self):
        """
        Sql injection para OTG-INVPAL-005
        """
        print("-----SQL INJECTION------")
        self.obj_invpal_005.sql_injection(self.url)

    def xss(self):
        """
        XSS cross site scripting para OTG-INVPAL-001
        """
        print("-----CROSS SITE SCRIPTING------")
        self.obj_invpal_001.xss_reflejado(self.url)

    def config_006(self):
        mc6(self.url)

    def config_007(self):
        mc7(self.url)

    def authz_002(self):
        maz2(self.url)

    def authn_003(self, url):
        os.chdir("FuerzaBruta_LogIn")
        man3(url)
        os.chdir("..")

    def crypst_001(self):
        os.chdir("Criptografia")
        mct1(self.url)
        os.chdir("..")

    def main(self):
        print("-----RECOPILACIÓN DE INFORMACIÓN-----")
        self.get_ip()
        self.port_scan()
        self.crawling()
        self.sql()
        self.xss()
        self.config_006()
        self.config_007()
        if self.args.fuerza_bruta_login:
            self.authn_003(self.args.fuerza_bruta_login)
        self.crypst_001()
        self.authz_002()
