import requests
import sys
import os


class Info_005:
    '''
    Retorna el código fuente HTML de la URL en busca
    de informaicón sensible en los metadatos
   :parámetro url: dirección del sitio web a revisar
   '''

    def download(self, url):
        global lst_msg
        lst_msg = ""
        print("Revisando metadatos ...")
        r = requests.get(url)
        if r.status_code != 200:
            sys.stderr.write("!Error {} recuperando {} ".format(r.status_code, url))
            return None

        lst_msg += r.text
        print("en lista")
        print(lst_msg)
        # self.write_file()
        return r.text

    def comentarios(self, url):
        '''
        Descarga la el sitio web con el comando wget y busca
        los comentarios con la opción grep
        '''
        print("Analizando comentarios ...")
        os.system("wget -q " + url + " -O page")
        os.system("grep '<!-' page > info-005-comments.txt")

    def write_file(self, cadena):
        fwrite = "info-005-metadata.txt"
        f = open(fwrite, "a")
        f.write(cadena)
        f.write("\n")
        f.close

    def main(self, url):
        # url = "http://190.5.199.22:8082/RegistroSiag"
        self.comentarios(url)
        r = self.download(url)
        if r:
            sys.stdout.write(r[:200])
            self.write_file(r[:200])
        else:
            msg_error = "No fue posible recuperar el sitio web\n"
            sys.stdout.write(msg_error)
            self.write_file(msg_error)
